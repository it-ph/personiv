var guest=angular.module("guest",["shared"]);guest.config(["$stateProvider",function(e){e.state("wall",{url:"/",views:{"":{templateUrl:"/app/guest/views/guest.view.html",controller:"wallViewController"},"content-container@wall":{templateUrl:"/app/shared/views/content-container.view.html",controller:"homeContentContainerController"},"toolbar@wall":{templateUrl:"/app/guest/templates/toolbar.template.html",controller:"homeToolbarController"},"content@wall":{templateUrl:"/app/components/app/templates/home.template.html"}}}).state("wall.posts",{url:"posts/{postID}",params:{postID:null},views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"wallContentContainerController"},"toolbar@wall.posts":{templateUrl:"/app/guest/templates/toolbar.template.html",controller:"wallToolbarController"},"content@wall.posts":{templateUrl:"/app/components/posts/templates/content/posts.template.html"}}}).state("wall.reservations",{url:"reservations",views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"reservationsContentContainerController"},"toolbar@wall.reservations":{templateUrl:"/app/guest/templates/toolbar.template.html",controller:"reservationsToolbarController"},"subheader@wall.reservations":{templateUrl:"/app/components/reservations/templates/subheaders/reservations-subheader.template.html",controller:"reservationsSubheaderController"},"content@wall.reservations":{templateUrl:"/app/components/reservations/templates/content/reservations-content.template.html"}}})}]),guest.controller("approvedReservationDialogController",["$scope","Helper",function(e,t){var o=t.fetch();e.cancel=function(){t.cancel()};var r={"with":[{relation:"location",withTrashed:!0},{relation:"user",withTrashed:!0},{relation:"equipment_types",withTrashed:!1},{relation:"equipment",withTrashed:!0},{relation:"schedule_approver",withTrashed:!0},{relation:"equipment_approver",withTrashed:!0}],withCount:[{relation:"equipment_types",withTrashed:!1}],where:[{label:"id",condition:"=",value:o.id}],first:!0};t.post("/reservation/enlist",r).success(function(t){t.start=new Date(t.start),t.end=t.end?new Date(t.end):null,e.reservation=t}).error(function(){t.error()})}]),guest.controller("homeContentContainerController",["$scope","Helper",function(e,t){e.$emit("closeSidenav"),e.toolbar={},e.init=function(){var o={};o["with"]=[{relation:"slides",withTrashed:!1}],o.first=!0,t.post("/slideshow/enlist",o).success(function(t){e.slideshow=t})}()}]),guest.controller("homeToolbarController",["$scope","Helper",function(e,t){e.toolbar.childState="Home",e.toolbar.hideSearchIcon=!0}]),guest.controller("repostsDialogController",["$scope","Helper",function(e,t){e.cancel=function(){t.cancel()};var o=t.fetch(),r={};r["with"]=[{relation:"post",withTrashed:!1}],r.where=[{label:"post_id",condition:"=",value:o.id}],r.orderBy=[{column:"created_at",order:"desc"}],r.paginate=10,e.repost={},e.repost.items=[],e.repost.page=2;var a=function(e){e.created_at=new Date(e.created_at)};t.post("/repost/enlist",r).success(function(o){e.repost.details=o,e.repost.items=o.data,e.repost.show=!0,o.data.length&&angular.forEach(o.data,function(e){a(e)}),e.repost.paginateLoad=function(){return e.repost.busy||e.repost.page>e.repost.details.last_page?void(e.isLoading=!1):(e.repost.busy=!0,e.isLoading=!0,void t.post("/repost/enlist?page="+e.repost.page,r).success(function(t){e.repost.page++,angular.forEach(t.data,function(t,o){a(t),e.repost.items.push(t)}),e.repost.busy=!1,e.isLoading=!1}))}})}]),guest.controller("reservationsContentContainerController",["$scope","$compile","Helper","uiCalendarConfig",function(e,t,o,r){e.$emit("closeSidenav"),e.toolbar={},e.toolbar.sortBy=function(t){t.sortReverse=!t.sortReverse,e.sortType=t.type,e.sortReverse=t.sortReverse},e.subheader={},e.subheader.show=!0,e.subheader.current={},e.viewReservation=function(e){o.set(e);var t={template:"/app/components/reservations/templates/dialogs/approved-reservation-dialog.template.html",controller:"approvedReservationDialogController"};o.customDialog(t)},e.editReservation=function(t){t.action="edit",o.set(t);var r={template:"/app/components/reservations/templates/dialogs/reservation-dialog.template.html",controller:"reservationDialogController"};o.customDialog(r).then(function(){o.notify("Reservation updated."),e.refresh()},function(){})},e.deleteReservation=function(t){var r={};r.title="Delete",r.message="Delete this reservation?",r.ok="Delete",r.cancel="Cancel",o.confirm(r).then(function(){o["delete"]("/reservation/"+t.id).success(function(){e.refresh(),o.notify("Reservation deleted.")}).error(function(){o.error()})},function(){})},e.uiConfig={calendar:{height:500,editable:!1,header:{left:"title",center:"",right:"today prev,next"},eventClick:e.viewReservation,eventDrop:e.alertOnDrop,eventResize:e.alertOnResize,viewRender:function(t){e.dateRange={},e.dateRange.start=new Date(t.start._d).toDateString(),e.dateRange.end=new Date(t.end._d).toDateString(),o.set(e.dateRange),e.$broadcast("dateRange"),e.init(e.subheader.current)}}},e.eventSources=[],e.changeView=function(e){r.calendars.reservationCalendar.fullCalendar("changeView",e)},e.calendarType="month",e.$on("setInit",function(){e.isLoading=!0,e.$broadcast("close");var t=o.fetch();e.subheader.current=t,e.init(t)}),e.$on("search",function(){e.subheader.current.request.search=e.toolbar.searchText,e.refresh()}),e.$on("refresh",function(){e.subheader.current.request.search=null,e.$broadcast("close"),e.refresh()});var a=function(t){t.deleted_at=t.deleted_at?new Date(t.deleted_at):null,t.created_at=new Date(t.created_at),t.start=new Date(t.start),t.end=new Date(t.end);var o={};o.display=t.title,e.toolbar.items.push(o)};e.init=function(t){e.reservation={},e.toolbar.items=[],o.post("/reservation/enlist",t.request).success(function(t){e.eventSources.splice(0,1),e.reservation.approved=[],e.reservation.pending=[],t.length&&(angular.forEach(t,function(t){a(t),t.schedule_approver_id&&t.equipment_types_count&&t.equipment_approver_id||t.schedule_approver_id&&!t.equipment_types_count?(t.title=t.title+" - "+t.location.name,e.reservation.approved.push(t)):e.reservation.pending.push(t)}),e.eventSources.push(e.reservation.approved)),e.refresh=function(){e.isLoading=!0,o.set(e.dateRange),e.$broadcast("dateRange"),e.init(e.subheader.current)}})}}]),guest.controller("reservationsSubheaderController",["$scope","Helper",function(e,t){var o=function(o){t.set(o),e.current_tab=o,e.$emit("setInit")};e.subheader.all={},e.subheader.all.label="All",e.subheader.all.request={"with":[{relation:"location",withTrashed:!1},{relation:"user",withTrashed:!0},{relation:"schedule_approver",withTrashed:!0},{relation:"equipment_approver",withTrashed:!0}],withCount:[{relation:"equipment_types",withTrashed:!1}]},e.subheader.all.action=function(){o(e.subheader.all)},e.$on("dateRange",function(){var o=t.fetch(),r={label:"start",start:o.start,end:o.end};e.subheader.all.request.whereBetween=r,angular.forEach(e.subheader.navs,function(e){e.request.whereBetween=r})}),e.init=function(){t.get("/location").success(function(t){e.locations=t,e.subheader.navs=[],angular.forEach(e.locations,function(t){var r={};r.id=t.id,r.label=t.name,r.request={"with":[{relation:"location",withTrashed:!1},{relation:"user",withTrashed:!1},{relation:"schedule_approver",withTrashed:!1},{relation:"equipment_approver",withTrashed:!1}],withCount:[{relation:"equipment_types",withTrashed:!1}],where:[{label:"location_id",condition:"=",value:t.id}]},r.action=function(e){o(e)},e.subheader.navs.push(r)}),o(e.subheader.all)})},e.init()}]),guest.controller("reservationsToolbarController",["$scope","$filter",function(e,t){e.toolbar.childState="Reservations",e.$on("close",function(){e.hideSearchBar()}),e.toolbar.getItems=function(o){var r=o?t("filter")(e.toolbar.items,o):e.toolbar.items;return r},e.toolbar.searchAll=!0,e.showSearchBar=function(){e.reservation.busy=!0,e.searchBar=!0},e.hideSearchBar=function(){e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.searched&&(e.searched=!1,e.$emit("refresh"))},e.searchUserInput=function(){e.$emit("search"),e.searched=!0},e.toolbar.options=!0,e.toolbar.refresh=function(){e.$emit("refresh")}}]),guest.controller("wallContentContainerController",["$scope","$stateParams","$state","Helper",function(e,t,o,r){e.$emit("closeSidenav"),e.viewReposts=function(e){var t={template:"/app/components/posts/templates/dialogs/reposts-dialog.template.html",controller:"repostsDialogController"};r.set(e),r.customDialog(t)},e.fetchComments=function(e){if(!e.comments){var t={};t.where=[{label:"post_id",condition:"=",value:e.id}],t["with"]=[{relation:"user",withTrashed:!0}],t.paginate=10,r.post("/comment/enlist",t).success(function(t){e.comment_details=t,e.comments=[],angular.forEach(t.data,function(t){t.created_at=new Date(t.created_at),t.updated_at=new Date(t.updated_at),e.comments.unshift(t)})})}},e.previousComments=function(e){var t=e.comment_details.current_page+1;if(t<=e.comment_details.last_page){var o={};o.where=[{label:"post_id",condition:"=",value:e.id}],o["with"]=[{relation:"user",withTrashed:!0}],o.paginate=10,r.post("/comment/enlist?page="+t,o).success(function(t){e.comment_details=t,angular.forEach(t.data,function(t){t.created_at=new Date(t.created_at),t.updated_at=new Date(t.updated_at),e.comments.unshift(t)})})}},e.toolbar={},e.$on("search",function(){e.request.search=e.toolbar.searchText,e.refresh()}),e.$on("refresh",function(){e.request.search=null,e.$broadcast("close"),e.refresh()});var a=function(t){t.created_at=new Date(t.created_at),t.repost_id&&(t.repost.post.created_at=new Date(t.repost.post.created_at),t.repost.post.chips=[],angular.forEach(t.repost.post.hashtags,function(e){t.repost.post.chips.push(e.tag)})),t.chips=[],angular.forEach(t.hashtags,function(e){t.chips.push(e.tag)});var o={};o.display=t.title,e.toolbar.items.push(o)};e.searchHashTag=function(t){e.toolbar.searchText=t,e.$broadcast("open")},e.init=function(t){e.post={},e.post.items=[],e.toolbar.items=[],e.currentTime=Date.now(),e.post.page=2,r.post("/post/enlist",t).success(function(o){e.post.details=o,e.post.items=o.data,e.post.show=!0,o.data.length&&angular.forEach(o.data,function(e){a(e)}),e.post.paginateLoad=function(){return e.post.busy||e.post.page>e.post.details.last_page?void(e.isLoading=!1):(e.post.busy=!0,e.isLoading=!0,void r.post("/post/enlist?page="+e.post.page,t).success(function(t){e.post.page++,angular.forEach(t.data,function(t,o){a(t),e.post.items.push(t)}),e.post.busy=!1,e.isLoading=!1}))}})},e.refresh=function(){t.postID?o.go("main.posts",{postID:null}):(e.isLoading=!0,e.post.show=!1,e.currentTime=Date.now(),e.request.where=null,e.init(e.request))},e.request={},e.request.withTrashed=!1,e.request.paginate=10,e.request["with"]=[{relation:"user",withTrashed:!1},{relation:"hashtags",withTrashed:!1},{relation:"repost.post",withTrashed:!1}],e.request.withCount=[{relation:"comments",withTrashed:!1}],e.request.whereNull=["group_id"],e.request.orderBy=[{column:"created_at",order:"desc"}],t.postID&&(e.request.where=[{label:"id",condition:"=",value:t.postID}]),e.isLoading=!0,e.$broadcast("close"),e.init(e.request)}]),guest.controller("wallToolbarController",["$scope","$filter",function(e,t){e.toolbar.childState="Posts",e.$on("close",function(){e.hideSearchBar()}),e.$on("open",function(){e.showSearchBar(),e.searchUserInput()}),e.toolbar.getItems=function(o){var r=o?t("filter")(e.toolbar.items,o):e.toolbar.items;return r},e.toolbar.searchAll=!0,e.showSearchBar=function(){e.searchBar=!0},e.hideSearchBar=function(){e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.searched&&(e.searched=!1,e.$emit("refresh"))},e.searchUserInput=function(){e.$emit("search"),e.searched=!0},e.toolbar.options=!0,e.toolbar.refresh=function(){e.$emit("refresh")}}]),guest.controller("wallViewController",["$scope","$mdMedia","$mdDialog","$mdSidenav","$mdToast","Helper",function(e,t,o,r,a,n){e.toggleSidenav=function(e){r(e).toggle()},e.menu={},n.get("/link").success(function(t){e.menu["static"]=t})}]);