var guest=angular.module("guest",["shared"]);guest.config(["$stateProvider",function(e){e.state("wall",{url:"/",views:{"":{templateUrl:"/app/guest/views/guest.view.html",controller:"wallViewController"},"content-container@wall":{templateUrl:"/app/shared/views/content-container.view.html",controller:"wallContentContainerController"},"toolbar@wall":{templateUrl:"/app/guest/templates/toolbar.template.html",controller:"wallToolbarController"},"content@wall":{templateUrl:"/app/components/posts/templates/content/posts.template.html"}}}).state("wall.reservations",{url:"reservations",views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"reservationsContentContainerController"},"toolbar@wall.reservations":{templateUrl:"/app/guest/templates/toolbar.template.html",controller:"reservationsToolbarController"},"subheader@wall.reservations":{templateUrl:"/app/components/reservations/templates/subheaders/reservations-subheader.template.html",controller:"reservationsSubheaderController"},"content@wall.reservations":{templateUrl:"/app/components/reservations/templates/content/reservations-content.template.html"}}})}]),guest.controller("approvedReservationDialogController",["$scope","Helper",function(e,t){var r=t.fetch();e.cancel=function(){t.cancel()};var a={"with":[{relation:"location",withTrashed:!0},{relation:"user",withTrashed:!0},{relation:"equipment_types",withTrashed:!1},{relation:"equipment",withTrashed:!0},{relation:"schedule_approver",withTrashed:!0},{relation:"equipment_approver",withTrashed:!0}],where:[{label:"id",condition:"=",value:r.id}],first:!0};t.post("/reservation/enlist",a).success(function(t){t.start=new Date(t.start),t.end=t.end?new Date(t.end):null,e.reservation=t}).error(function(){t.error()})}]),guest.controller("reservationsContentContainerController",["$scope","$compile","Helper","uiCalendarConfig",function(e,t,r,a){e.$emit("closeSidenav"),e.toolbar={},e.toolbar.sortBy=function(t){t.sortReverse=!t.sortReverse,e.sortType=t.type,e.sortReverse=t.sortReverse},e.subheader={},e.subheader.show=!0,e.subheader.current={},e.viewReservation=function(e){r.set(e);var t={template:"/app/components/reservations/templates/dialogs/approved-reservation-dialog.template.html",controller:"approvedReservationDialogController"};r.customDialog(t)},e.editReservation=function(t){t.action="edit",r.set(t);var a={template:"/app/components/reservations/templates/dialogs/reservation-dialog.template.html",controller:"reservationDialogController"};r.customDialog(a).then(function(){r.notify("Reservation updated."),e.refresh()},function(){})},e.deleteReservation=function(t){var a={};a.title="Delete",a.message="Delete this reservation?",a.ok="Delete",a.cancel="Cancel",r.confirm(a).then(function(){r["delete"]("/reservation/"+t.id).success(function(){e.refresh(),r.notify("Reservation deleted.")}).error(function(){r.error()})},function(){})},e.uiConfig={calendar:{height:500,editable:!1,header:{left:"title",center:"",right:"today prev,next"},eventClick:e.viewReservation,eventDrop:e.alertOnDrop,eventResize:e.alertOnResize,viewRender:function(t){e.dateRange={},e.dateRange.start=new Date(t.start._d).toDateString(),e.dateRange.end=new Date(t.end._d).toDateString(),r.set(e.dateRange),e.$broadcast("dateRange"),e.init(e.subheader.current)}}},e.eventSources=[],e.changeView=function(e){a.calendars.reservationCalendar.fullCalendar("changeView",e)},e.calendarType="month",e.$on("setInit",function(){e.isLoading=!0,e.$broadcast("close");var t=r.fetch();e.subheader.current=t,e.init(t)}),e.$on("search",function(){e.subheader.current.request.search=e.toolbar.searchText,e.refresh()}),e.$on("refresh",function(){e.subheader.current.request.search=null,e.$broadcast("close"),e.refresh()});var o=function(t){t.deleted_at=t.deleted_at?new Date(t.deleted_at):null,t.created_at=new Date(t.created_at),t.start=new Date(t.start),t.end=new Date(t.end);var r={};r.display=t.title,e.toolbar.items.push(r)};e.init=function(t){e.reservation={},e.toolbar.items=[],r.post("/reservation/enlist",t.request).success(function(t){e.eventSources.splice(0,1),e.reservation.approved=[],e.reservation.pending=[],t.length&&(angular.forEach(t,function(t){o(t),t.schedule_approver_id&&t.equipment_approver_id?e.reservation.approved.push(t):e.reservation.pending.push(t)}),e.eventSources.push(e.reservation.approved)),e.refresh=function(){e.isLoading=!0,r.set(e.dateRange),e.$broadcast("dateRange"),e.init(e.subheader.current)}})}}]),guest.controller("reservationsSubheaderController",["$scope","Helper",function(e,t){var r=function(r){t.set(r),e.current_tab=r,e.$emit("setInit")};e.subheader.all={},e.subheader.all.label="All",e.subheader.all.request={"with":[{relation:"location",withTrashed:!1},{relation:"user",withTrashed:!0},{relation:"schedule_approver",withTrashed:!0},{relation:"equipment_approver",withTrashed:!0}]},e.subheader.all.action=function(){r(e.subheader.all)},e.$on("dateRange",function(){var r=t.fetch(),a={label:"start",start:r.start,end:r.end};e.subheader.all.request.whereBetween=a,angular.forEach(e.subheader.navs,function(e){e.request.whereBetween=a})}),e.init=function(){t.get("/location").success(function(t){e.locations=t,e.subheader.navs=[],angular.forEach(e.locations,function(t){var a={};a.id=t.id,a.label=t.name,a.request={"with":[{relation:"location",withTrashed:!1},{relation:"user",withTrashed:!1},{relation:"schedule_approver",withTrashed:!1},{relation:"equipment_approver",withTrashed:!1}],where:[{label:"location_id",condition:"=",value:t.id}]},a.action=function(e){r(e)},e.subheader.navs.push(a)}),r(e.subheader.all)})},e.init()}]),guest.controller("reservationsToolbarController",["$scope","$filter",function(e,t){e.toolbar.childState="Reservations",e.$on("close",function(){e.hideSearchBar()}),e.toolbar.getItems=function(r){var a=r?t("filter")(e.toolbar.items,r):e.toolbar.items;return a},e.toolbar.searchAll=!0,e.showSearchBar=function(){e.reservation.busy=!0,e.searchBar=!0},e.hideSearchBar=function(){e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.searched&&(e.searched=!1,e.$emit("refresh"))},e.searchUserInput=function(){e.$emit("search"),e.searched=!0},e.toolbar.options=!0,e.toolbar.refresh=function(){e.$emit("refresh")}}]),guest.controller("wallContentContainerController",["$scope","Helper",function(e,t){e.$emit("closeSidenav"),e.fetchComments=function(e){if(!e.comments){var r={};r.where=[{label:"post_id",condition:"=",value:e.id}],r["with"]=[{relation:"user",withTrashed:!0}],r.paginate=10,t.post("/comment/enlist",r).success(function(t){e.comment_details=t,e.comments=[],angular.forEach(t.data,function(t){t.created_at=new Date(t.created_at),t.updated_at=new Date(t.updated_at),e.comments.unshift(t)})})}},e.previousComments=function(e){var r=e.comment_details.current_page+1;if(r<=e.comment_details.last_page){var a={};a.where=[{label:"post_id",condition:"=",value:e.id}],a["with"]=[{relation:"user",withTrashed:!0}],a.paginate=10,t.post("/comment/enlist?page="+r,a).success(function(t){e.comment_details=t,angular.forEach(t.data,function(t){t.created_at=new Date(t.created_at),t.updated_at=new Date(t.updated_at),e.comments.unshift(t)})})}},e.toolbar={},e.$on("search",function(){e.request.search=e.toolbar.searchText,e.refresh()}),e.$on("refresh",function(){e.request.search=null,e.$broadcast("close"),e.refresh()});var r=function(t){t.created_at=new Date(t.created_at),t.repost_id&&(t.repost.post.created_at=new Date(t.repost.post.created_at),t.repost.post.chips=[],angular.forEach(t.repost.post.hashtags,function(e){t.repost.post.chips.push(e.tag)})),t.chips=[],angular.forEach(t.hashtags,function(e){t.chips.push(e.tag)});var r={};r.display=t.title,e.toolbar.items.push(r)};e.searchHashTag=function(t){e.toolbar.searchText=t,e.$broadcast("open")},e.init=function(a){e.post={},e.post.items=[],e.toolbar.items=[],e.currentTime=Date.now(),e.post.page=2,t.post("/post/enlist",a).success(function(o){e.post.details=o,e.post.items=o.data,e.post.show=!0,o.data.length&&angular.forEach(o.data,function(e){r(e)}),e.post.paginateLoad=function(){return e.post.busy||e.post.page>e.post.details.last_page?void(e.isLoading=!1):(e.post.busy=!0,e.isLoading=!0,void t.post("/post/enlist?page="+e.post.page,a).success(function(t){e.post.page++,angular.forEach(t.data,function(t,a){r(t),e.post.items.push(t)}),e.post.busy=!1,e.isLoading=!1}))}})},e.refresh=function(){e.isLoading=!0,e.post.show=!1,e.init(e.request)},e.request={},e.request.withTrashed=!1,e.request.paginate=10,e.request["with"]=[{relation:"user",withTrashed:!1},{relation:"hashtags",withTrashed:!1},{relation:"repost.post",withTrashed:!1}],e.request.withCount=[{relation:"comments",withTrashed:!1}],e.request.whereNull=["group_id"],e.request.orderBy=[{column:"pinned",order:"desc"},{column:"created_at",order:"desc"}],e.isLoading=!0,e.$broadcast("close"),e.init(e.request)}]),guest.controller("wallToolbarController",["$scope","$filter",function(e,t){e.toolbar.childState="Posts",e.$on("close",function(){e.hideSearchBar()}),e.$on("open",function(){e.showSearchBar(),e.searchUserInput()}),e.toolbar.getItems=function(r){var a=r?t("filter")(e.toolbar.items,r):e.toolbar.items;return a},e.toolbar.searchAll=!0,e.showSearchBar=function(){e.searchBar=!0},e.hideSearchBar=function(){e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.searched&&(e.searched=!1,e.$emit("refresh"))},e.searchUserInput=function(){e.$emit("search"),e.searched=!0},e.toolbar.options=!0,e.toolbar.refresh=function(){e.$emit("refresh")}}]),guest.controller("wallViewController",["$scope","$mdMedia","$mdDialog","$mdSidenav","$mdToast","Helper",function(e,t,r,a,o,n){e.toggleSidenav=function(e){a(e).toggle()},e.menu={},n.get("/link").success(function(t){e.menu["static"]=t})}]);